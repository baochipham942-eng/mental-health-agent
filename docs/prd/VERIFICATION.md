# 前端 MVP 验证步骤

## 一、环境准备

1. **安装依赖**
   ```bash
   npm install
   ```

2. **启动开发服务器**
   ```bash
   npm run dev
   ```

3. **打开浏览器**
   访问 `http://localhost:3000`

## 二、功能验证

### 2.1 评估路径验证（assessment）

#### 步骤 1：intake 阶段
1. 在输入框中输入："最近工作压力很大，经常失眠"
2. 点击"发送"按钮
3. **验证点**：
   - ✅ 系统返回 1-2 个评估问题
   - ✅ 问题显示在蓝色背景的区块中（intake 阶段样式）
   - ✅ 显示"为了更好地了解你的情况，请回答以下问题："

#### 步骤 2：gap_followup 阶段（可选）
1. 回答评估问题，例如："持续了2周，影响睡眠和工作，评分8分"
2. 点击"发送"按钮
3. **验证点**：
   - ✅ 如有信息缺口，系统追问澄清问题
   - ✅ 澄清问题显示在橙色背景的区块中（gap_followup 阶段样式）
   - ✅ 显示"我需要你补充："提示

#### 步骤 3：conclusion 阶段
1. 补充回答后，系统进入 conclusion 阶段
2. **验证点**：
   - ✅ 显示【初筛总结】区块（灰色背景）
   - ✅ 显示【风险与分流】区块（黄色背景，或红色背景如果是 crisis）
   - ✅ 显示【下一步行动清单】（2-3条，蓝色背景，可勾选）
   - ✅ 显示【行动卡片】（2张，白色卡片，可展开）

### 2.2 行动卡片验证

1. 进入 conclusion 阶段后，查看行动卡片
2. **验证点**：
   - ✅ 卡片折叠态：显示标题、适用场景、预计时长/次数（低/中/高标签）、"开始/展开"按钮
   - ✅ 点击"开始/展开"按钮后，展开显示 steps 列表（每步 ≤16 汉字）
   - ✅ 点击"开始练习"按钮后，以更大字号/分步方式呈现 steps
   - ✅ 点击"返回步骤列表"按钮，返回步骤列表视图

### 2.3 下一步清单验证

1. 进入 conclusion 阶段后，查看下一步行动清单
2. **验证点**：
   - ✅ 显示 2-3 条清单项
   - ✅ 每条清单项可勾选"我完成了"
   - ✅ 已勾选项显示删除线或灰色
   - ✅ 刷新页面后，勾选状态已保存（localStorage）

### 2.4 Crisis 路由验证

1. 输入高风险表达："我想死" 或 "伤害自己的想法：经常出现"
2. 点击"发送"按钮
3. **验证点**：
   - ✅ 系统路由为 crisis
   - ✅ 显示红色 Banner："⚠️ 检测到高风险表达，建议立即寻求专业帮助"
   - ✅ 【风险与分流】区块显示红色背景
   - ✅ 显示求助建议区块（包含求助热线、资源链接等）

### 2.5 支持路径验证（support）

1. 输入："我只想倾诉，不要建议"
2. 点击"发送"按钮
3. **验证点**：
   - ✅ 系统路由为 support
   - ✅ 系统提供共情倾听，不显示结构化区块
   - ✅ 回复为普通 markdown 文本

### 2.6 降级策略验证

1. 模拟 zod 校验失败（需要修改后端返回的 `actionCards` 格式，或使用测试数据）
2. **验证点**：
   - ✅ 隐藏结构化区块（NextStepsChecklist、ActionCardGrid）
   - ✅ 将 `reply` 作为纯文本/markdown 渲染
   - ✅ Debug 面板显示"结构化解析失败原因"（如果 DEBUG_PROMPTS 开启）

### 2.7 Debug 面板验证

1. 确保环境变量 `DEBUG_PROMPTS=1`（如果后端支持）
2. 完成一次对话，进入 conclusion 阶段
3. **验证点**：
   - ✅ 右下角显示"显示 Debug"按钮
   - ✅ 点击后展开 Debug 面板
   - ✅ 显示 `debugPrompts` 信息（systemPrompt、userPrompt、selectedSkillIds 等）
   - ✅ 如果校验失败，显示 `validationError` 信息

### 2.8 移动端验证

1. 使用浏览器开发者工具切换到移动端视图（或使用真实移动设备）
2. **验证点**：
   - ✅ 输入框固定在底部，键盘弹出不遮挡
   - ✅ 使用 `safe-area-inset-bottom` 适配底部安全区域
   - ✅ 消息气泡在小屏幕上正确显示（max-w-[80%]）
   - ✅ 行动卡片在移动端单列显示

### 2.9 输入交互验证

1. **Enter 发送**：
   - ✅ 在输入框中按 Enter，消息发送
2. **Shift+Enter 换行**：
   - ✅ 在输入框中按 Shift+Enter，输入框换行
3. **加载状态**：
   - ✅ 发送消息后，显示"发送中..."和加载动画
   - ✅ 发送期间输入框禁用

### 2.10 错误处理验证

1. 模拟网络错误（断开网络或修改 API 地址）
2. **验证点**：
   - ✅ 显示错误提示（红色提示框）
   - ✅ 错误信息清晰易懂
   - ✅ 可以继续输入和发送（错误不影响后续操作）

## 三、数据验证

### 3.1 请求数据验证

1. 打开浏览器开发者工具 → Network 标签
2. 发送一条消息
3. **验证点**：
   - ✅ 请求体包含 `message`、`history`、`state`、`assessmentStage`、`meta.initialMessage`
   - ✅ 多轮对话时，`state` 和 `assessmentStage` 正确传递

### 3.2 响应数据验证

1. 查看 Network 标签中的响应数据
2. **验证点**：
   - ✅ 正确解析 `routeType`、`state`、`assessmentStage`
   - ✅ 正确解析 `actionCards`（使用 zod 校验）
   - ✅ 正确解析 `reply` 文本中的【下一步清单】（从文本中提取）

### 3.3 状态持久化验证

1. 完成一次对话
2. 刷新页面
3. **验证点**：
   - ✅ 对话历史已保存（localStorage）
   - ✅ 下一步清单的勾选状态已保存
   - ✅ 状态信息（`state`、`routeType`、`assessmentStage`）已保存

## 四、UI/UX 验证

### 4.1 视觉风格

- ✅ 参考"壹心理"：专业但不冷冰、倾诉入口显眼
- ✅ 参考"小睡眠/冥想类"：轻量练习卡片、步骤清晰
- ✅ UI 调性：克制、温和、偏"生活方式产品"，避免医院感
- ✅ Crisis 路由：严肃醒目（红色 Banner）

### 4.2 响应式

- ✅ 移动端适配（max-w、safe-area）
- ✅ 输入栏 sticky 定位（移动端键盘弹出不遮挡）
- ✅ 行动卡片网格在移动端单列显示

### 4.3 交互反馈

- ✅ 加载状态显示（三个跳动的圆点）
- ✅ 错误提示显示（红色提示框）
- ✅ 勾选/展开等操作有视觉反馈

## 五、性能验证

1. **页面加载时间**：
   - ✅ 首次加载 < 2s
2. **消息发送响应时间**：
   - ✅ 依赖后端，前端处理 < 100ms
3. **滚动流畅度**：
   - ✅ 消息列表滚动流畅（60fps）

## 六、常见问题排查

### 问题 1：zustand persist 报错
**解决方案**：确保安装了 `zustand` 最新版本，并使用 `createJSONStorage`。

### 问题 2：react-markdown 报错
**解决方案**：确保安装了 `react-markdown` 包。

### 问题 3：结构化区块不显示
**检查点**：
- 后端是否返回了 `assessmentStage: 'conclusion'`
- `actionCards` 是否通过 zod 校验
- `reply` 文本中是否包含【下一步清单】等标记

### 问题 4：移动端输入框被键盘遮挡
**检查点**：
- 是否使用了 `pb-safe` 类
- 是否设置了 `sticky bottom-0`
- 浏览器是否支持 `safe-area-inset-bottom`

---

**验证完成标准**：所有验证点均通过 ✅
